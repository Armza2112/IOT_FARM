<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wifi Manage page</title>
    <style>
         @font-face {
            font-family: 'headerfont';
            src: url('/assets/fnt/header.ttf') format('truetype');
        }
         @font-face {
            font-family: 'detailfont';
            src: url('/assets/fnt/detail.ttf') format('truetype');
        }
        .button{
            width: 350px;
            height: 40px;
            border-radius: 10px;
            font-family: 'detailfont';
            font-weight: bold;
            outline: none;         
            border: none;          
            box-shadow: none;     
        }
        .text__wifi{
            color: white;
            font-family: 'detailfont';
            font-weight: bold;
        }
        .input__box{
            width: 350px;
            height: 40px;  
            background-color: #2F2F2F;   
            color: #9B9B9B;                
            border: none;
            border-radius: 10px;
            padding: 5px 20px;
            outline: none;
            appearance: none;            
            -webkit-appearance: none;
            -moz-appearance: none;
            box-sizing: border-box;
            font-family: 'detailfont';
        }
    </style>
</head>
<body style="display: flex; justify-content: center; flex-direction:column; align-items: center; margin: 0; background-color: #262626; gap:50px; padding-left:50px; padding-right:50px; height: calc(var(--vh, 1vh) * 100);">
    <div style="display: flex; align-items: center; "> 
        <div>
            <img src="/assets/img/LOGO.png" alt="Logo" width="110px">
        </div>
        <div style="margin-left:10px">
            <div >
                <h1 style="margin: 0; font-family:'headerfont'; color:white; font-size:42px";>IOT V6 WEB</h1>
                <p style="text-align:right; margin: 0; font-family:'headerfont'; color:white; font-size:12px">V.0.0.1</p>
            </div>
            <div style="width: 100%; height:2px; background-color:grey; margin-top:5px; margin-bottom:5px;">
            </div>
            <div>
                <h2 style="margin: 0; font-family:'headerfont'; color:grey">WiFi Manage Page</h2>
            </div>
        </div>
    </div>
    <div style="width: 100%; background-color:#2F2F2F; border-radius:10px; display:flex; justify-content:center; align-items:center;">
        <div style="text-align:center">
            <div style="gap:10px; display:flex; align-items:center;">
                <img id="wifiIMG" width="20px"/>
                <p id="wifiSSID" class="text__wifi" style="font-size: 12px;">-</p>
            </div>
            <p id="wifiRSSI" class="text__wifi" style="font-size: 10px;">-</p>
        </div>
    </div>
    <div>
        <form method="POST" style="text-align: center;" id="wifiFORM">
        <select id="ssidSELECT" name="ssid" class="input__box">
            %OPTIONS%
        </select><br><br>
        <input type="password" id="pass" name="password" class="input__box"/><br><br>
        <p id="statusName" style="text-align: center;"></p>
        <button id="Btn" class="button" style="background-color: #3B83C5; color:white" type="submit"></button>
    </form>
    <p style="color: gray; font-family: 'headerfont'; text-align:center;">Powered by Lertthings</p>
    </div>
    <script>
        let ssid = "%SSID%";  
        let rrsi ="%RSSI%"
        let btn = document.getElementById('Btn');  
        let status = document.getElementById('statusName');  
        let select = document.getElementById('ssidSELECT');  
        let hidden = document.createElement("input");
        let form = document.getElementById("wifiFORM")
        if (ssid && ssid !== "" && ssid!= "Not connected") {
            document.getElementById('wifiIMG').src = "/assets/img/online.png";
            document.getElementById('wifiSSID').textContent = "Connected to: "+ssid;
            document.getElementById('wifiRSSI').textContent = "Level Signal: " + rrsi + "dbm";
            select.innerHTML = `<option value="${ssid}" selected>${ssid}</option>`;
            select.disabled = true;
            select.parentNode.appendChild(hidden);
            hidden.type = "hidden";
            hidden.name = "ssid";
            hidden.value = ssid;
            form.action = "/disconnect";
            btn.textContent="Disconnect"
        } else {
            document.getElementById('wifiIMG').src = "/assets/img/offline.png";
            document.getElementById('wifiSSID').textContent = "Unconnected WiFi";
            btn.textContent="Connect"
            form.action = "/connect";
        }
        function setVh() {
        let vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        setVh();
        window.addEventListener('resize', setVh);
        document.getElementById('wifiFORM').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);
    const body = new URLSearchParams(formData);

    if (btn.textContent === "Connect") {
        const resp = await fetch('/connect', { method: 'POST', body });
        const data = await resp.json();
        if (data.status === 'ok') {
            status.textContent = "Connecting...";
            status.style.color = "green"
            window.location.href = "/";
        } else {
            status.textContent = "Wrong password";
            status.style.color = "red"
        }
    } else if (btn.textContent === "Disconnect") {
        const resp = await fetch('/disconnect', { method: 'POST' });
        const data = await resp.json();
        if (data.status === 'disconnecting') {
            status.textContent = "Disconnecting...";
            status.style.color = "red"
            setTimeout(() => { window.location.href = "/"; }, 5000);
        }
    }
});
    </script>
</body>
</html>