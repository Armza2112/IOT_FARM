<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home page</title>
    <style>
      @font-face {
        font-family: "headerfont";
        src: url("/assets/fnt/header.ttf") format("truetype");
      }
      @font-face {
        font-family: "detailfont";
        src: url("/assets/fnt/detail.ttf") format("truetype");
      }
      .button {
        width: 350px;
        height: 40px;
        border-radius: 10px;
        font-family: "detailfont";
        font-weight: bold;
        outline: none;
        border: none;
        box-shadow: none;
      }
      .text__wifi {
        color: white;
        font-family: "detailfont";
        font-weight: bold;
      }
    </style>
  </head>
  <body
    style="
      display: flex;
      justify-content: center;
      flex-direction: column;
      align-items: center;
      margin: 0;
      background-color: #262626;
      gap: 50px;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 100px;
      height: calc(var(--vh, 1vh) * 100);
    "
  >
    <div style="display: flex; align-items: center">
      <div>
        <img src="/assets/img/LOGO.png" alt="Logo" width="110px" />
      </div>
      <div style="margin-left: 10px">
        <div>
          <h1
            style="
              margin: 0;
              font-family: 'headerfont';
              color: white;
              font-size: 38px;
              white-space: nowrap;
            "
            ;
          >
            WEB MANAGEMENT
          </h1>
          <p
            style="
              text-align: right;
              margin: 0;
              font-family: 'headerfont';
              color: white;
              font-size: 12px;
            "
          >
            V.1.0.0
          </p>
        </div>
        <div
          style="
            width: 100%;
            height: 2px;
            background-color: grey;
            margin-top: 5px;
            margin-bottom: 5px;
          "
        ></div>
        <div>
          <h2 style="margin: 0; font-family: 'headerfont'; color: grey">
            HOME PAGE
          </h2>
        </div>
      </div>
    </div>
    <div
      style="
        width: 100%;
        background-color: #2f2f2f;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
      "
    >
      <div style="text-align: center">
        <div
          style="gap: 10px; display: flex; align-items: center; height: 70px"
        >
          <img id="wifiIMG" width="20px" />
          <p id="wifiSSID" class="text__wifi" style="font-size: 12px">-</p>
        </div>
        <!-- <p id="wifiRSSI" class="text__wifi" style="font-size: 10px">-</p> -->
      </div>
    </div>
    <div style="text-align: center">
      <p
        style="
          color: gray;
          font-family: 'headerfont';
          font-size: 24;
          margin-bottom: 30px;
        "
      >
        Detail
      </p>
      <p style="color: white; font-family: 'headerfont'; font-size: 22">
        Mac address: %MAC%
      </p>
      <p style="color: white; font-family: 'headerfont'; font-size: 22">
        Device ID: %DEVICE_ID%
      </p>
      <p style="color: white; font-family: 'headerfont'; font-size: 22">
        Key register: %KEY%
      </p>
      <p style="color: white; font-family: 'headerfont'; font-size: 22">
        Subscription: -
      </p>
      <p style="color: white; font-family: 'headerfont'; font-size: 22"></p>
      <br />
      <p style="color: white; font-family: 'headerfont'; font-size: 22">
        Hardware Version:
      </p>
      <p style="color: white; font-family: 'headerfont'; font-size: 22">
        Firmware Version: V.1.0.0 (22/22/24)
      </p>
    </div>
    <div
      style="
        display: flex;
        flex-direction: column;
        gap: 10px;
        text-align: center;
      "
    >
      <button
        class="button"
        style="background-color: #3b83c5; color: white"
        onclick="location.href='/wifimanage'"
      >
        WiFi Manager
      </button>
      <button
      class="button"
      style="background-color: #3b83c5; color: white"
        id="refreshBtn"
      >
      Refresh
    </button>
    <button class="button" style="background-color: #2f2f2f; color: #3b83c5">
        Test
    </button>
    <button
      class="button"
      style="background-color: #2f2f2f; color: #3b83c5"
      id="restartBtn"
    >
      Finish
    </button>
    <p style="color: gray; font-family: 'headerfont'">Powered by Lerthings</p>
    <p
    id="statusName"
    style="font-family: 'detailFont'; font-size: 18; color: red"
    ></p>
</div>
<div
id="popup"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      "
    >
      <div
        style="
          background: #2f2f2f;
          padding: 50px;
          border-radius: 10px;
          color: white;
          font-family: 'detailfont';
          text-align: center;
          height: 300px;
        "
      >
        <img id="popImg" alt="Logo" width="60px" />
        <h1 id="popTopic" style="font-family: 'headerfont'; color: white"></h1>
        <p
          id="popupMsg"
          style="font-family: 'detailfont'; color: #838383; margin-top: 50px"
        ></p>
        <button
          id="acceptBtn"
          style="
            margin-top: 50px;
            height: 40px;
            width: 150px;
            border: none;
            border-radius: 5px;
            background: #3b83c5;
            color: white;
            font-family: 'detailfont';
            font-weight: bold;
            font-size: 12px;
          "
        >
          Accecpt
        </button>
      </div>
    </div>
    <script>
      let ssid = "%SSID%";
      let rssi = parseInt("%RSSI%");
      let wifi = "%WIFI%";
      if (ssid && ssid !== "" && ssid != "Not connected") {
        if (wifi == "false")
          document.getElementById("wifiIMG").src = "/assets/img/wifi_fail.png";
        else if (rssi >= -50)
          document.getElementById("wifiIMG").src = "/assets/img/wifi_4.png";
        else if (rssi >= -65)
          document.getElementById("wifiIMG").src = "/assets/img/wifi_3.png";
        else if (rssi >= -80)
          document.getElementById("wifiIMG").src = "/assets/img/wifi_2.png";
        else document.getElementById("wifiIMG").src = "/assets/img/wifi_1.png";

        document.getElementById("wifiSSID").textContent =
          "Connected to: " + ssid;
      } else {
        document.getElementById("wifiIMG").src = "/assets/img/offline.png";
        document.getElementById("wifiSSID").textContent = "Unconnected WiFi";
      }
      function setVh() {
        let vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty("--vh", `${vh}px`);
      }
      setVh();
      window.addEventListener("resize", setVh);

      const status = document.getElementById("statusName");
      const btn = document.getElementById("restartBtn");

      btn.addEventListener("click", async () => {
        document.getElementById("popImg").src = "/assets/img/correct.png";
        document.getElementById("popTopic").textContent = "Finish Setup";
        document.getElementById("popupMsg").textContent =
          "â—Œ Finish set up wifi!. Web server is down.......";
        document.getElementById("popup").style.display = "flex";
        setTimeout(async () => {
          try {
            const resp = await fetch("/restart", { method: "GET" });
            const data = await resp.json();
            console.log("Restart response:", data);
          } catch (err) {
            status.textContent = "Error connecting to ESP32";
            status.style.color = "red";
            console.error(err);
          }
        }, 1000);
      });
      document.getElementById("acceptBtn").addEventListener("click", () => {
        window.location.reload();
      });
      document.getElementById("refreshBtn").addEventListener("click", () => {
        window.location.reload();
      });
    </script>
  </body>
</html>